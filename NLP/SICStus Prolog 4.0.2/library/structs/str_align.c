/*  File   : structs_align.c
    Author : Peter Schachte
    Updated: 8/28/89
    Purpose: check out alignment constants for this C compiler

    Copyright (C) 1988, Quintus Computer Systems, Inc.  All rights reserved.

    This program autoamtically determines alignment constants used by the
    C compiler that compiles it.  It should be very portable.
    The output is written to stdout.

*/
#include <stdlib.h>
#include <stdio.h>

/* z in a1 is a dummy to avoid SunPro C compiler
   allocating b1 on a 2-byte boundary
*/
struct a {char x; char y; short z;} a1;

struct b {char x; short y;} b1;

struct c {char x; int y;} c1;

struct d {char x; char *y;} d1;

struct e {char x; float y;} e1;

struct f {char x; double y;} f1;

struct g {char x; long y;} g1;


#define alignment(var) (((char *)(&(var.y))) - ((char *)(&(var.x))))


int
#ifdef _WIN32
__cdecl                         /* [PM] 4.0.0beta1 main() must use C calling convention */
#endif  /* _WIN32 */
main(int argc, char *argv[])
    {
      (void)argc; (void)argv;

	printf(
	    "%% This file automatically generated by structs_align\n");
	printf(
	    "%% Do not edit this file manually!\n\n");
	printf( ":- module(alignments, [\n");
	printf( "\tprimitive_type_size/3,\n");
	printf( "\tpointer_alignment/2\n");
	printf( "   ]).\n\n");

	printf( "primitive_type_size(integer, %d, %d).\n",
		(int)sizeof(long), (int)alignment(g1));
	printf( "primitive_type_size(integer_32, %d, %d).\n",
		(int)sizeof(int), (int)alignment(c1));
	printf( "primitive_type_size(integer_16, %d, %d).\n",
		(int)sizeof(short), (int)alignment(b1));
	printf( "primitive_type_size(integer_8, %d, %d).\n",
		(int)sizeof(char), (int)alignment(a1));
	printf( "primitive_type_size(unsigned, %d, %d).\n",
		(int)sizeof(unsigned long), (int)alignment(g1));
	printf( "primitive_type_size(unsigned_32, %d, %d).\n",
		(int)sizeof(unsigned int), (int)alignment(c1));
	printf( "primitive_type_size(unsigned_16, %d, %d).\n",
		(int)sizeof(unsigned short), (int)alignment(b1));
	printf( "primitive_type_size(unsigned_8, %d, %d).\n",
		(int)sizeof(unsigned char), (int)alignment(a1));
	printf( "primitive_type_size(float, %d, %d).\n",
		(int)sizeof(double), (int)alignment(f1));
	printf( "primitive_type_size(float_32, %d, %d).\n",
		(int)sizeof(float), (int)alignment(e1));
	printf( "primitive_type_size(atom, %d, %d).\n",
		(int)sizeof(long), (int)alignment(g1));
	printf( "primitive_type_size(string, %d, %d).\n",
		(int)sizeof(char *), (int)alignment(d1));
	printf( "primitive_type_size(address, %d, %d).\n",
		(int)sizeof(char *), (int)alignment(d1));
	printf( "primitive_type_size(opaque, unknown, unknown).\n\n");

	printf( "pointer_alignment(%d, %d).\n\n",
		(int)sizeof(char *), (int)alignment(d1));

	printf( "%% end of automatically generated file\n");
	exit(0);
    }
